<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BÃ¼tÃ§e">
    <meta name="theme-color" content="#6c5ce7">
    <title>BÃ¼tÃ§e Takip</title>

    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@10.7.1/firebase-app-compat.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@10.7.1/firebase-database-compat.min.js"></script>

    <style>
        :root {
            --bg-primary: #f8f5f1; --bg-secondary: #ffffff; --bg-card: #ffffff;
            --text-primary: #2d3436; --text-secondary: #636e72;
            --accent-income: #00b894; --accent-expense: #e17055;
            --accent-main: #6c5ce7; --border-color: #e0dcd7; --shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Nunito', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-primary); color: var(--text-primary); padding-bottom: 100px; line-height: 1.5; }

        /* UI BileÅŸenleri */
        .header { background: linear-gradient(135deg, var(--accent-main) 0%, #a29bfe 100%); padding: 60px 20px 30px; color: white; border-radius: 0 0 30px 30px; }
        .currency-badge { background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; display: inline-block; margin-top: 10px; }
        
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; margin-top: -25px; }
        .summary-card { background: var(--bg-card); padding: 20px; border-radius: 24px; box-shadow: var(--shadow); }
        .summary-card.full { grid-column: 1 / -1; background: var(--accent-main); color: white; }
        .amount { font-size: 1.4rem; font-weight: 800; margin-top: 5px; }

        .tabs { display: flex; margin: 20px; background: #eeebe6; border-radius: 15px; padding: 5px; }
        .tab { flex: 1; padding: 12px; text-align: center; border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.3s; color: var(--text-secondary); }
        .tab.active { background: white; color: var(--accent-main); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }

        .section { display: none; padding: 0 20px; }
        .section.active { display: block; }

        /* BilanÃ§o KartlarÄ± */
        .bs-card { background: white; border-radius: 20px; padding: 15px; margin-bottom: 15px; box-shadow: var(--shadow); }
        .bs-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
        .bs-row:last-child { border-bottom: none; }

        .floating-btn { position: fixed; bottom: 30px; right: 20px; width: 65px; height: 65px; background: var(--accent-main); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4); z-index: 100; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="font-weight: 800; font-size: 1.8rem;">Selam Akif ðŸ‘‹</h2>
    <div id="usdRateDisplay" class="currency-badge"><i class="fas fa-chart-line"></i> USD: YÃ¼kleniyor...</div>
</div>

<div class="summary-grid">
    <div class="summary-card full" id="eqResult">
        <div style="opacity: 0.9; font-weight: 600;">Net VarlÄ±k (BilanÃ§o)</div>
        <div id="bsTotalEquity" class="amount">â‚º0,00</div>
    </div>
    <div class="summary-card">
        <div style="color: var(--text-secondary); font-size: 0.85rem; font-weight: 700;">GELÄ°R</div>
        <div id="totalIncome" class="amount" style="color: var(--accent-income)">â‚º0,00</div>
    </div>
    <div class="summary-card">
        <div style="color: var(--text-secondary); font-size: 0.85rem; font-weight: 700;">GÄ°DER</div>
        <div id="totalExpense" class="amount" style="color: var(--accent-expense)">â‚º0,00</div>
    </div>
</div>

<div class="tabs">
    <div class="tab active" onclick="switchTab('budget')">BÃ¼tÃ§e</div>
    <div class="tab" onclick="switchTab('balance')">BilanÃ§o</div>
</div>

<div id="budgetSection" class="section active">
    <canvas id="budgetChart" style="max-height: 200px; margin-bottom: 20px;"></canvas>
    <div id="transactionList"></div>
</div>

<div id="balanceSection" class="section">
    <div class="bs-card">
        <h4 style="color: var(--accent-income); margin-bottom: 10px;">VarlÄ±klar</h4>
        <div class="bs-row"><span>Nakit</span> <b id="bsCash">â‚º0</b></div>
        <div class="bs-row"><span>Banka</span> <b id="bsBank">â‚º0</b></div>
        <div class="bs-row"><span>Dolar HesabÄ±</span> <b id="bsUsdAcc">â‚º0</b></div>
    </div>
    <div class="bs-card">
        <h4 style="color: var(--accent-expense); margin-bottom: 10px;">BorÃ§lar</h4>
        <div class="bs-row"><span>Kredi KartlarÄ±</span> <b id="bsCredits">â‚º0</b></div>
        <div class="bs-row"><span>BorÃ§lar</span> <b id="bsDebts">â‚º0</b></div>
    </div>
</div>

<div class="floating-btn" onclick="alert('Ekleme modali buraya gelecek')"><i class="fas fa-plus"></i></div>

<script>
// ==================== CONFIG & DATA ====================
let USD_RATE = 31.00; // API Ã§alÄ±ÅŸmazsa yedek kur

// Firebase Bilgilerin (Akif DosyasÄ±ndan AlÄ±nmalÄ±)
const firebaseConfig = {
    apiKey: "AIzaSy...",
    databaseURL: "https://...",
    projectId: "...",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ==================== CANLI KUR Ã‡EKME (DÄ°ÄžER DOSYADAN) ====================
async function updateUSDExchangeRate() {
    try {
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        const data = await response.json();
        USD_RATE = data.rates.TRY;
        document.getElementById('usdRateDisplay').innerHTML = `<i class="fas fa-chart-line"></i> USD: â‚º${USD_RATE.toFixed(2)}`;
        updateAll();
    } catch (e) {
        console.log("Kur Ã§ekilemedi, sabit kur kullanÄ±lÄ±yor.");
        document.getElementById('usdRateDisplay').innerHTML = `<i class="fas fa-chart-line"></i> USD: â‚º${USD_RATE.toFixed(2)} (Sabit)`;
    }
}

// ==================== HESAPLAMA VE UI ====================
function formatCurrency(val) {
    return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(val);
}

function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    if(tab === 'budget') {
        document.querySelector('.tab:nth-child(1)').classList.add('active');
        document.getElementById('budgetSection').classList.add('active');
    } else {
        document.querySelector('.tab:nth-child(2)').classList.add('active');
        document.getElementById('balanceSection').classList.add('active');
    }
}

function updateAll() {
    db.ref('data').on('value', (snapshot) => {
        const data = snapshot.val() || {};
        const balance = data.balanceSheet || { assets: {}, liabilities: {} };
        
        // BilanÃ§o Hesaplama (DiÄŸer dosyadaki mantÄ±k)
        let cash = parseFloat(balance.assets.cash || 0);
        let bank = parseFloat(balance.assets.bank || 0);
        let usdVal = parseFloat(balance.assets.usdAmount || 0) * USD_RATE; // DolarÄ± Ã§evir
        
        let totalAssets = cash + bank + usdVal;
        
        let credits = parseFloat(balance.liabilities.credits || 0);
        let debts = parseFloat(balance.liabilities.debts || 0);
        let totalLiabilities = credits + debts;
        
        let netEquity = totalAssets - totalLiabilities;

        // UI GÃ¼ncelleme
        document.getElementById('bsCash').textContent = formatCurrency(cash);
        document.getElementById('bsBank').textContent = formatCurrency(bank);
        document.getElementById('bsUsdAcc').textContent = formatCurrency(usdVal);
        document.getElementById('bsCredits').textContent = formatCurrency(credits);
        document.getElementById('bsDebts').textContent = formatCurrency(debts);
        document.getElementById('bsTotalEquity').textContent = formatCurrency(netEquity);
        
        // Renk deÄŸiÅŸimi
        document.getElementById('eqResult').style.background = netEquity >= 0 ? 'var(--accent-main)' : '#d63031';
    });
}

// BaÅŸlangÄ±Ã§
updateUSDExchangeRate();
</script>
</body>
</html>
